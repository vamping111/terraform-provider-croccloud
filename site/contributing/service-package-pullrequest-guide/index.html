<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Service Package Refactor Pull Request Guide - Terraform AWS Provider - Contributor Guide</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../stylesheets/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Terraform AWS Provider - Contributor Guide</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/hashicorp/terraform-provider-aws/tree/main/docs/contributing/service-package-pullrequest-guide.md" class="nav-link">Edit on hashicorp/terraform-provider-rockitcloud
                                    </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#service-package-refactor-pull-request-guide" class="nav-link">Service Package Refactor Pull Request Guide</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#fixing-a-pre-refactor-pull-request" class="nav-link">Fixing a Pre-Refactor Pull Request</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="service-package-refactor-pull-request-guide">Service Package Refactor Pull Request Guide<a class="headerlink" href="#service-package-refactor-pull-request-guide" title="Permanent link">#</a></h1>
<p>Pull request
<a href="https://github.com/hashicorp/terraform-provider-aws/pull/21306">#21306</a> has
significantly refactored the AWS provider codebase. Specifically, the code for
all AWS resources and data sources has been relocated from a single <code>aws</code>
directory to a large number of separate directories in <code>internal/service</code>, each
corresponding to a particular AWS service. In addition to vastly simplifying
the codebase's overall structure, this change has also allowed us to simplify
the names of a number of underlying functions -- without encountering namespace
collisions. Issue
<a href="https://github.com/hashicorp/terraform-provider-aws/issues/20000">#20000</a>
contains a more complete description of these changes.</p>
<p>As a result, nearly every pull request opened prior to the refactoring has merge
conflicts; they are attempting to apply changes to files that have since been
relocated. Furthermore, any new files or functions introduced must be brought
into line with the codebase's new conventions. The following steps are intended
to resolve such a conflict -- though it should be noted that this guide is an
active work in progress as additional pull requests are ameneded.</p>
<p>These fixes, however, <em>in no way affect the prioritization</em> of a particular
pull request. Once a pull request has been selected for review, the necessary
changes will be made by a maintainer -- either directly or in collaboration
with the pull request author.</p>
<h2 id="fixing-a-pre-refactor-pull-request">Fixing a Pre-Refactor Pull Request<a class="headerlink" href="#fixing-a-pre-refactor-pull-request" title="Permanent link">#</a></h2>
<ol>
<li>
<p><code>git checkout</code> the branch pertaining to the pull request you wish to amend</p>
</li>
<li>
<p>Begin a merge of the latest version of <code>main</code> branch into your local branch:
   <code>git pull origin main</code>. Merge conflicts are expected.</p>
</li>
<li>
<p>For any <strong>new file</strong>, rename and move the file to its appropriate service
   package directory:</p>
</li>
</ol>
<p><strong>Resource Files</strong></p>
<div class="highlight"><pre><span></span><code>  git mv aws/resource_aws_{service_name}_{resource_name}.go \
  internal/service/{service_name}/{resource_name}.go
</code></pre></div>
<p><strong>Resource Test Files</strong></p>
<div class="highlight"><pre><span></span><code>  git mv aws/resource_aws_{service_name}_{resource_name}_test.go \
  internal/service/{service_name}/{resource_name}_test.go
</code></pre></div>
<p><strong>Data Source Files</strong></p>
<div class="highlight"><pre><span></span><code>  git mv aws/data_source_aws_{service_name}_{resource_name}.go \
  internal/service/{service_name}/{resource_name}_data_source.go
</code></pre></div>
<p><strong>Data Source Test Files</strong></p>
<div class="highlight"><pre><span></span><code>  git mv aws/data_source_aws_{service_name}_{resource_name}_test.go \
  internal/service/{service_name}/{resource_name}_data_source_test.go
</code></pre></div>
<ol>
<li>For any new <strong>function</strong>, rename the function appropriately:</li>
</ol>
<p><strong>Resource Schema Functions</strong></p>
<div class="highlight"><pre><span></span><code>  func resourceAws{ResourceName}() =&gt;
  func Resource{ResourceName}()
</code></pre></div>
<p><strong>Resource Generic Functions</strong></p>
<div class="highlight"><pre><span></span><code>  func resourceAws{ServiceName}{ResourceName}{FunctionName}() =&gt;
  func resource{ResourceName}{FunctionName}()
</code></pre></div>
<p><strong>Resource Acceptance Test Functions</strong></p>
<div class="highlight"><pre><span></span><code>  func TestAccAWS{ServiceName}{ResourceName}_{testType}() =&gt;
  func TestAcc{ResourceName}_{testType}()
</code></pre></div>
<p><strong>Data Source Schema Functions</strong></p>
<div class="highlight"><pre><span></span><code>  func dataSourceAws{ResourceName}() =&gt;
  func DataSource{ResourceName}()
</code></pre></div>
<p><strong>Data Source Generic Functions</strong></p>
<div class="highlight"><pre><span></span><code>  func dataSourceAws{ServiceName}{ResourceName}{FunctionName}() =&gt;
  func dataSource{ResourceName}{FunctionName}()
</code></pre></div>
<p><strong>Data Source Acceptance Test Functions</strong></p>
<div class="highlight"><pre><span></span><code>  func TestAccDataSourceAWS{ServiceName}{ResourceName}_{testType}() =&gt;
  func TestAcc{ResourceName}DataSource_{testType}()
</code></pre></div>
<p><strong>Finder Functions</strong></p>
<div class="highlight"><pre><span></span><code>  func finder.{FunctionName}() =&gt;
  func Find{FunctionName}()
</code></pre></div>
<p><strong>Status Functions</strong></p>
<div class="highlight"><pre><span></span><code>  func waiter.{FunctionName}Status() =&gt;
  func status{FunctionName}()
</code></pre></div>
<p><strong>Waiter Functions</strong></p>
<div class="highlight"><pre><span></span><code>  func waiter.{FunctionName}() =&gt;
  func wait{FunctionName}()
</code></pre></div>
<ol>
<li>If a file has a package declaration of <code>package aws</code>, you will need to change
   it to the new package location. For example, if you moved a file to <code>internal/service/ecs</code>,
   the declaration will now be <code>package ecs</code>.</li>
</ol>
<p>Any file that imports <code>"github.com/hashicorp/terraform-provider-aws/internal/acctest"</code> <em>must</em>
   be in the <code>&lt;package&gt;_test</code> package. For example, <code>internal/service/ecs/account_setting_default_test.go</code>
   does import the <code>acctest</code> package and must have a package declaration of <code>package ecs_test</code>.</p>
<ol>
<li>If you have made any changes to <code>aws/provider.go</code>, you will have to manually
   re-enact those changes on the new <code>internal/provider/provider.go</code> file.</li>
</ol>
<p>Most commonly, these changes involve the addition of an entry to either the
   <code>DataSourcesMap</code> or <code>ResourcesMap</code>. If this is the case for your PR, you will have
   to adapt your entry to follow our new code conventions.</p>
<p><strong>Resources Map Entries</strong></p>
<div class="highlight"><pre><span></span><code>  &quot;{aws_terraform_resource_type}&quot;:   resourceAws{ServiceName}{ResourceName}(), =&gt;
  &quot;{aws_terraform_resource_type}&quot;:   {serviceName}.Resource{ResourceName}(),
</code></pre></div>
<p><strong>Data Source Map Entries</strong></p>
<div class="highlight"><pre><span></span><code>  &quot;{aws_terraform_data_source_type}&quot;:   dataSourceAws{ServiceName}{ResourceName}(), =&gt;
  &quot;{aws_terraform_data_source_type}&quot;:   {serviceName}.DataSource{ResourceName}(),
</code></pre></div>
<ol>
<li>Some functions, constants, and variables have been moved, removed, or renamed.
   This table shows some of the common changes you may need to make to fix compile errors.</li>
</ol>
<table>
<thead>
<tr>
<th>Before</th>
<th>Now</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>isAWSErr(α, β, "&lt;message&gt;")</code></td>
<td><code>tfawserr.ErrMessageContains(α, β, "&lt;message&gt;")</code></td>
</tr>
<tr>
<td><code>isAWSErr(α, β, "")</code></td>
<td><code>tfawserr.ErrCodeEquals(α, β)</code></td>
</tr>
<tr>
<td><code>isResourceNotFoundError(α)</code></td>
<td><code>tfresource.NotFound(α)</code></td>
</tr>
<tr>
<td><code>isResourceTimeoutError(α)</code></td>
<td><code>tfresource.TimedOut(α)</code></td>
</tr>
<tr>
<td><code>testSweepSkipResourceError(α)</code></td>
<td><code>tfawserr.ErrCodeContains(α, "AccessDenied")</code></td>
</tr>
<tr>
<td><code>testAccPreCheck(t)</code></td>
<td><code>acctest.PreCheck(t)</code></td>
</tr>
<tr>
<td><code>testAccProviders</code></td>
<td><code>acctest.Providers</code></td>
</tr>
<tr>
<td><code>acctest.RandomWithPrefix("tf-acc-test")</code></td>
<td><code>sdkacctest.RandomWithPrefix(acctest.ResourcePrefix)</code></td>
</tr>
<tr>
<td><code>composeConfig(α)</code></td>
<td><code>acctest.ConfigCompose(α)</code></td>
</tr>
</tbody>
</table>
<ol>
<li>Use <code>git status</code> to report the state of the merge. Review any merge
   conflicts -- being sure to adopt the new naming conventions described in the
   previous step where relevant. Use <code>git add</code> to add any new files to the commit.</li>
</ol></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>HashiCorp</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
